@model IEnumerable<Enfermeria_app.Models.EnfCita>
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

@{
    ViewData["Title"] = "Comprobantes de Citas";
    var desde = ViewBag.Desde as string ?? DateTime.Today.ToString("yyyy-MM-dd");
    var hasta = ViewBag.Hasta as string ?? DateTime.Today.ToString("yyyy-MM-dd");
}

<div class="container mt-4">
    <h2 class="mb-3 text-center">@ViewData["Title"]</h2>

    <!-- 🔎 Filtros de fecha -->
    <form method="get" asp-action="Index" class="row g-2 g-md-3 align-items-end mb-3">
        <div class="col-6 col-md-3">
            <label class="form-label fw-semibold">Desde</label>
            <input type="date" name="desde" class="form-control" value="@desde" />
        </div>
        <div class="col-6 col-md-3">
            <label class="form-label fw-semibold">Hasta</label>
            <input type="date" name="hasta" class="form-control" value="@hasta" />
        </div>

        <div class="col-12 col-md-auto">
            <button class="btn btn-primary w-100">
                <i class="bi bi-filter-circle"></i> Filtrar
            </button>
        </div>

        <div class="col-12 col-md-auto">
            <a class="btn btn-outline-secondary w-100"
               asp-action="DescargarRango"
               asp-route-desde="@desde"
               asp-route-hasta="@hasta">
                <i class="bi bi-download"></i> PDF (rango)
            </a>
        </div>
    </form>

    <!-- 🔔 Mensaje si no hay citas -->
    @if (!Model.Any())
    {
        <div class="alert alert-info text-center">
            No hay citas registradas en el rango seleccionado.
        </div>
    }
    else
    {
        <!-- 📋 Tabla responsiva -->
        <div class="table-responsive">
            <table class="table table-striped align-middle text-center">
                <thead class="table-dark">
                    <tr>
                        <th>Fecha</th>
                        <th>Hora</th>
                        <th>Nombre</th>
                        <th>Cédula</th>
                        <th>Estado</th>
                        <th>Llegada</th>
                        <th>Salida</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var c in Model)
                    {
                        <tr>
                            <td>@c.IdHorarioNavigation?.Fecha.ToDateTime(TimeOnly.MinValue).ToString("dd/MM/yyyy")</td>
                            <td>@c.IdHorarioNavigation?.Hora.ToString("HH\\:mm")</td>
                            <td class="text-break">@c.IdPersonaNavigation?.Nombre</td>
                            <td>@c.IdPersonaNavigation?.Cedula</td>
                            <td>
                                <span class="badge bg-@(c.Estado == "Atendida" ? "success" :
                                                                                            c.Estado == "Cancelada" ? "danger" :
                                                                                            "secondary")">
                            @c.Estado
                        </span>
                    </td>
                    <td>@(c.HoraLlegada?.ToString("HH\\:mm") ?? "-")</td>
                    <td>@(c.HoraSalida?.ToString("HH\\:mm") ?? "-")</td>
                    <td>
                        <a class="btn btn-sm btn-outline-primary w-100 w-md-auto"
                           asp-action="Descargar"
                           asp-route-id="@c.Id">
                            <i class="bi bi-file-earmark-arrow-down"></i> PDF
                        </a>
                    </td>
                </tr>
                                }
                </tbody>
            </table>
        </div>
    }
</div>

@section Styles {
    <style>
        /* 📱 Estilos responsivos */
        @@media (max-width: 768px) {
            h2 {
                font-size: 1.25rem;
            }

            table th, table td {
                font-size: 0.85rem;
                white-space: nowrap;
            }

            .btn {
                font-size: 0.8rem;
                padding: 0.35rem 0.6rem;
            }

            .table-responsive {
                overflow-x: auto;
            }
        }
    </style>
}

