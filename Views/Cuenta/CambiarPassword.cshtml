@{
    ViewData["Title"] = "Cambiar Contraseña";
    var usuario = ViewBag.Usuario as string ?? "";
}

<h2 class="mb-3 text-center">Cambiar Contraseña</h2>

@if (ViewBag.Error != null)
{
    <div class="alert alert-danger">@ViewBag.Error</div>
}
@if (ViewBag.Exito != null)
{
    <div class="alert alert-success">@ViewBag.Exito</div>
}

<form asp-action="CambiarPassword" method="post" class="card p-4 mx-auto shadow-sm" style="max-width: 500px;">
    @Html.AntiForgeryToken()
    <input type="hidden" name="usuario" value="@usuario" />

    <div class="mb-3">
        <label class="form-label">Contraseña actual</label>
        <input type="password" name="passwordActual" class="form-control" required />
    </div>

    <div class="mb-3">
        <label class="form-label">Nueva contraseña</label>
        <input type="password" name="nuevaPassword" id="nuevaPassword" class="form-control" required />
        <small class="text-muted">
            Debe tener al menos 8 caracteres, una mayúscula, una minúscula, un número y un símbolo.
        </small>
    </div>

    <div class="mb-3">
        <label class="form-label">Confirmar nueva contraseña</label>
        <input type="password" name="confirmarPassword" class="form-control" required />
    </div>

    <div class="text-center">
        <button type="submit" class="btn btn-primary w-100">Guardar nueva contraseña</button>
    </div>
</form>

@section Scripts {
    <script>
        const pass = document.getElementById('nuevaPassword');
        pass?.addEventListener('input', () => {
            const v = pass.value;
            const ok = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[\W_]).{8,}$/.test(v);
            pass.style.borderColor = ok ? 'green' : 'red';
        });
    </script>
}
